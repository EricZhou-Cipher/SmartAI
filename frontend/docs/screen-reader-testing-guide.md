# 屏幕阅读器测试指南

本指南旨在帮助开发团队使用屏幕阅读器进行系统性测试，确保我们的应用对于依赖辅助技术的用户是可访问的。

## 一、屏幕阅读器基础

### 主要屏幕阅读器工具

| 屏幕阅读器 | 平台      | 获取方式                              | 主要快捷键                                             |
| ---------- | --------- | ------------------------------------- | ------------------------------------------------------ |
| VoiceOver  | macOS/iOS | 内置                                  | macOS: Cmd+F5开启/关闭<br>iOS: 三指点击或"设置>无障碍" |
| NVDA       | Windows   | [NVDA官网](https://www.nvaccess.org/) | Ctrl+Alt+N开启<br>NVDA+Q退出                           |
| JAWS       | Windows   | 商业软件                              | Insert键为主要修饰键                                   |
| TalkBack   | Android   | 内置                                  | 三指点击或"设置>无障碍"                                |

### 基本操作命令

#### VoiceOver (macOS)

- **启动/关闭**: Cmd+F5
- **下一项**: VO+右箭头 (VO = Control+Option)
- **上一项**: VO+左箭头
- **阅读当前项**: VO+空格
- **激活项目**: VO+空格 或 回车键
- **阅读全页**: VO+A
- **进入Web区域**: VO+Shift+下箭头
- **离开Web区域**: VO+Shift+上箭头

#### NVDA (Windows)

- **启动**: Ctrl+Alt+N
- **停止**: NVDA+Q
- **下一项**: Tab
- **上一项**: Shift+Tab
- **阅读当前行**: NVDA+L
- **阅读当前焦点项**: NVDA+Tab
- **浏览模式切换**: NVDA+空格
- **阅读全页**: NVDA+下箭头 (连续)

## 二、测试准备

### 测试前准备工作

1. **设置屏幕阅读器环境**

   - 确保已安装/启用至少一种屏幕阅读器
   - 熟悉基本导航命令
   - 调整屏幕阅读器设置为标准语速和详细程度

2. **准备测试用例**

   - 针对每个组件或页面创建测试场景
   - 确定预期的屏幕阅读器行为
   - 准备测试数据（如必要）

3. **记录工具准备**
   - 准备记录表格或工具
   - 可考虑录屏以捕获屏幕阅读器行为

### 测试环境设置

- **浏览器选择**:

  - NVDA/JAWS: 优先使用Firefox或Chrome
  - VoiceOver: 优先使用Safari
  - 每种组合至少测试一次

- **设备设置**:
  - 关闭其他可能干扰的应用程序
  - 使用耳机以便清晰听到屏幕阅读器输出
  - 考虑关闭显示器模拟盲用户体验

## 三、系统性测试流程

### 基本流程测试

#### 1. 页面加载测试

- 页面加载时屏幕阅读器是否宣告页面标题
- 焦点是否自动定位到主要内容区域
- 区域性标记（landmark）是否被正确宣告

#### 2. 导航测试

- 使用Tab键在页面元素间导航
- 验证Tab键顺序是否合乎逻辑
- 测试导航链接、菜单、按钮是否可访问
- 跳过链接（Skip to content）是否工作正常

#### 3. 表单测试

- 每个表单字段是否有正确的标签
- 必填字段是否被标记并宣告
- 表单错误是否被清晰宣告
- 验证成功/失败状态是否被宣告

#### 4. 动态内容测试

- 弹出内容（模态框、提示）是否被宣告
- 自动更新内容是否通过aria-live宣告
- 加载状态是否被适当宣告

### 组件特定测试

#### 1. TransactionList组件测试

1. 进入页面，验证组件标题是否被宣告
2. Tab到搜索框，确认能听到标签和说明
3. 填写搜索内容并提交，确认结果状态被宣告
4. Tab到状态筛选按钮，确认当前选中状态被宣告
5. 测试键盘导航交易列表的能力:
   - 使用Tab进入列表
   - 使用上下箭头在交易间移动
   - 按Enter选择一条交易
   - 验证交易详情是否被宣告

#### 2. TransactionFlowChart组件测试

1. 进入图表区域，验证图表标题和目的被宣告
2. 使用Tab键导航到可访问元素列表
3. 确认节点和链接信息被完整宣告
4. 测试选择节点/链接时状态变化的宣告
5. 验证是否可以通过键盘完成所有交互操作

#### 3. RiskBadge组件测试

1. 确认风险等级被正确宣告
2. 验证颜色信息是否通过文本被传达
3. 检查屏幕阅读器是否能理解风险分数含义

## 四、测试记录与问题报告

### 测试记录表格模板

| 测试项   | 预期行为                   | VoiceOver | NVDA | 问题 | 严重程度 |
| -------- | -------------------------- | --------- | ---- | ---- | -------- |
| 页面加载 | 宣告页面标题和主要内容     |           |      |      |          |
| Tab导航  | 按逻辑顺序访问所有交互元素 |           |      |      |          |
| 表单输入 | 宣告标签、状态和错误       |           |      |      |          |
| ...      | ...                        |           |      |      |          |

### 问题报告格式

报告无障碍问题时，请包含以下信息：

1. **问题概述**: 简要描述问题
2. **复现步骤**: 详细的重现步骤
3. **当前行为**: 屏幕阅读器当前如何表现
4. **预期行为**: 屏幕阅读器应该如何表现
5. **测试环境**:
   - 操作系统和版本
   - 浏览器和版本
   - 屏幕阅读器和版本
6. **WCAG相关准则**: 如适用，引用相关的WCAG准则
7. **建议修复**: 可能的解决方案

## 五、常见组件测试要点

### 按钮与交互控件

- **按钮测试**:

  - 屏幕阅读器是否宣告按钮标签
  - 按钮状态（禁用/激活）是否被宣告
  - 切换按钮的状态变化是否被宣告
  - 是否可通过Enter或空格激活

- **链接测试**:
  - 链接文本是否描述了目标
  - 外部链接是否被标识
  - 是否通过Enter激活

### 表单控件

- **文本输入测试**:

  - 标签是否被宣告
  - 必填状态是否被宣告
  - 错误信息是否与字段关联
  - 辅助描述是否被宣告

- **选择控件测试**:
  - 当前选中项是否被宣告
  - 是否可通过键盘选择选项
  - 选项组是否有描述性标签

### 数据展示

- **表格测试**:

  - 表头是否被识别
  - 数据单元格是否与表头正确关联
  - 复杂表格中的数据关系是否明确

- **图表测试**:
  - 是否有替代文本说明
  - 数据点是否可以通过键盘导航
  - 关键信息是否通过非视觉方式传达

## 六、测试案例示例

### 完整测试案例: 交易搜索与筛选流程

**测试目标**: 确保用户可以使用屏幕阅读器搜索和筛选交易列表

**测试步骤**:

1. **页面导航**

   - 打开交易管理页面
   - 使用屏幕阅读器确认页面标题
   - 导航到主要内容区域

2. **搜索功能测试**

   - Tab到搜索框
   - 确认搜索框标签和描述被宣告
   - 输入搜索关键词 "0x742d"
   - 提交搜索
   - 验证结果状态是否被宣告（如"找到2条匹配记录"）

3. **筛选功能测试**

   - Tab到状态筛选按钮组
   - 使用箭头键选择"已确认"筛选器
   - 确认筛选器选中状态被宣告
   - 验证筛选结果状态被宣告

4. **交易列表导航**
   - Tab进入交易列表
   - 使用上下箭头浏览交易
   - 确认每条交易关键信息（发送方、接收方、金额等）被宣告
   - 按Enter选择一条交易
   - 验证交易详情是否被宣告或打开

**预期结果**:

- 所有交互元素都能被屏幕阅读器识别
- 状态变化被清晰宣告
- 用户可以完全通过键盘和屏幕阅读器完成整个流程

## 七、持续集成与团队协作

### 团队测试安排

- 每个迭代至少进行一次全面屏幕阅读器测试
- 关键功能变更后立即进行针对性测试
- 轮流指派团队成员进行无障碍测试，增强团队意识

### 结合自动化测试

- 自动化测试作为第一道防线
- 运行`yarn a11y:check`作为前置条件
- 将屏幕阅读器测试作为自动化测试的补充

### 问题优先级确定

| 严重程度 | 定义                         | 处理时间         |
| -------- | ---------------------------- | ---------------- |
| 严重     | 阻止用户完成关键任务         | 当前迭代必须修复 |
| 主要     | 显著影响用户体验但有替代方案 | 下一迭代计划修复 |
| 次要     | 影响较小的易用性问题         | 根据优先级排期   |

---

## 八、资源与参考

### 学习资源

- [WebAIM屏幕阅读器使用指南](https://webaim.org/articles/screenreader/)
- [A11Y Project的屏幕阅读器测试工具](https://www.a11yproject.com/resources/#screen-readers)
- [MDN的ARIA开发指南](https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA)

### 键盘快捷键参考卡

- [VoiceOver命令参考](https://www.apple.com/voiceover/info/guide/_1131.html)
- [NVDA快捷键一览表](https://www.nvaccess.org/files/nvda/documentation/keyCommands.html)
- [JAWS键盘命令](https://support.freedomscientific.com/Content/Documents/Manuals/JAWS/keystrokes.htm)

### 相关标准

- [WCAG 2.1 AA标准](https://www.w3.org/TR/WCAG21/)
- [WAI-ARIA实践指南](https://www.w3.org/TR/wai-aria-practices-1.1/)

---

记住，屏幕阅读器测试不仅是为了满足无障碍标准，更是为了确保所有用户能够有效地使用我们的产品。持续实践和改进是提升产品无障碍性能的关键。
