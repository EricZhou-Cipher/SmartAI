# 无障碍开发检查清单

本文档提供了一个全面的无障碍检查清单，供开发人员在构建和优化组件时使用。请在开发新组件或修改现有组件时遵循这些准则，以确保我们的应用对所有用户都是可访问的。

## 通用检查项

### 键盘可访问性

- [ ] 所有交互元素（按钮、链接等）可通过键盘访问（Tab键导航）
- [ ] 所有交互元素有明显的焦点状态样式（使用`:focus`和`:focus-visible`样式）
- [ ] 无键盘陷阱 - 用户可以使用键盘进入和离开所有UI组件
- [ ] 可聚焦元素的Tab导航顺序在逻辑上是合理的
- [ ] 对于自定义组件，使用`FocusableItem`或实现正确的键盘事件处理

### 颜色和视觉

- [ ] 文本颜色与背景颜色的对比度符合WCAG AA标准（普通文本4.5:1，大文本3:1）
- [ ] 不仅依赖颜色传达信息（使用附加的图标、文本或其他视觉提示）
- [ ] 链接与周围文本有明显的视觉区别（不仅是颜色上的区别）
- [ ] 焦点指示器清晰可见，对比度足够
- [ ] 在高对比度模式下正常显示（测试Windows高对比度模式）

### 页面结构和语义

- [ ] 使用正确的标题层级（h1-h6），页面只有一个h1
- [ ] 使用适当的ARIA角色和属性增强HTML语义
- [ ] 使用列表（`<ul>`、`<ol>`）表示列表内容
- [ ] 使用表格（`<table>`）表示表格数据
- [ ] 可折叠内容使用适当的`aria-expanded`状态

### 图片和多媒体

- [ ] 所有非装饰性图片有alt文本描述
- [ ] 装饰性图片使用`alt=""`或CSS背景图片
- [ ] 复杂图表/图像有详细的文本描述
- [ ] 视频有字幕和文字记录
- [ ] 音频内容有文字记录

### 表单和输入

- [ ] 所有表单控件都有关联的标签
- [ ] 错误信息清晰且靠近相关字段
- [ ] 必填字段明确标记（视觉上和语义上）
- [ ] 表单验证错误提供明确的纠正指导
- [ ] 组合表单控件（如日期选择器）有明确的使用说明

## 组件级检查

### 交互组件

#### 按钮和链接

- [ ] 使用`FocusableItem`替代原生点击元素
- [ ] 实现键盘事件处理（Enter/Space触发点击）
- [ ] 添加适当的ARIA属性（`role`, `aria-pressed`等）
- [ ] 确保有足够大的点击/触摸区域（至少44x44px）
- [ ] 状态变化有清晰的视觉提示

#### 模态对话框

- [ ] 打开时焦点自动移到对话框内第一个可交互元素
- [ ] 焦点限制在对话框内（焦点陷阱实现）
- [ ] 提供关闭按钮和Escape键关闭功能
- [ ] 使用`role="dialog"`和`aria-modal="true"`
- [ ] 对话框打开时背景内容使用`aria-hidden="true"`

#### 下拉菜单和组合框

- [ ] 使用`aria-expanded`指示展开状态
- [ ] 菜单项可通过键盘导航（上下箭头）
- [ ] 实现Home和End键导航到第一个/最后一个选项
- [ ] 菜单关闭时焦点返回触发元素
- [ ] 适当使用`aria-activedescendant`或列表导航

### 表单元素

#### 输入框

- [ ] 使用`A11yFormInput`替代原生输入元素
- [ ] 确保每个输入字段有明确可见的标签
- [ ] 提供适当的输入提示（placeholder不作为标签）
- [ ] 使用`aria-describedby`关联辅助描述文本
- [ ] 错误状态使用`aria-invalid`并提供错误消息

#### 复选框和单选按钮

- [ ] 使用语义正确的HTML元素（`<input type="checkbox">`或`<input type="radio">`）
- [ ] 相关选项组使用`fieldset`和`legend`分组
- [ ] 自定义样式不影响键盘可访问性
- [ ] 正确实现`checked`和`aria-checked`状态
- [ ] 提供足够大的可点击区域

#### 选择框和日期选择器

- [ ] 确保键盘用户可以完全操作
- [ ] 日期选择支持手动输入日期
- [ ] 提供清晰的日期格式说明
- [ ] 实现箭头键导航
- [ ] 所选值变化时发出通知（使用`aria-live`）

### 数据展示

#### 表格

- [ ] 使用正确的表格语义（`<table>`, `<th>`, `<td>`等）
- [ ] 为表头单元格设置`scope`属性
- [ ] 复杂表格使用`id`和`headers`属性关联数据
- [ ] 可排序表头列使用`aria-sort`属性
- [ ] 大型表格提供分页导航

#### 选项卡

- [ ] 使用正确的ARIA角色（`role="tablist"`, `role="tab"`, `role="tabpanel"`）
- [ ] 实现键盘导航（左右箭头在选项卡间移动）
- [ ] 使用`aria-selected`标记当前选项卡
- [ ] 使用`aria-controls`和`id`关联面板
- [ ] 选项卡变化时焦点管理正确

#### 数据图表

- [ ] 提供可访问的替代数据表示（文本或表格）
- [ ] 使用有意义的颜色编码，不仅依赖颜色区分数据
- [ ] 图表标题和轴标签清晰
- [ ] 为交互式图表元素添加键盘支持
- [ ] 提供适当的文字说明和上下文

## 代码提交前检查

### 无障碍自动化测试

- [ ] 运行`yarn a11y:check`确认没有严重无障碍问题
- [ ] 审核无障碍报告中的警告和建议
- [ ] 针对特定组件运行`yarn a11y:check components/YourComponent.tsx`

### 屏幕阅读器验证

- [ ] 至少使用一种屏幕阅读器测试过关键功能
- [ ] 确认动态变化的内容被正确宣告
- [ ] 验证错误消息被适当地提醒给辅助技术

### 键盘导航测试

- [ ] 完全不使用鼠标，仅通过键盘操作完成主要流程
- [ ] 确认焦点指示器始终可见
- [ ] 验证焦点顺序合理且遵循视觉顺序

---

## 使用无障碍组件库

我们的应用提供了一套无障碍组件库，强烈建议在开发中使用这些组件，以确保应用的无障碍性能：

### 核心组件

- `FocusableItem`: 用于所有自定义交互元素，提供统一的焦点管理
- `A11yFormInput`: 确保表单控件的无障碍性
- `FocusTrap`: 用于模态对话框等需要捕获焦点的场景
- `AccessibleMenu`: 实现无障碍下拉菜单

### 工具钩子

- `useKeyboardNavigation`: 提供键盘导航支持
- `useA11y`: 访问全局无障碍设置和通知功能

### 使用方法示例

```tsx
import { FocusableItem } from './a11y/FocusableItem';
import useKeyboardNavigation from '../hooks/useKeyboardNavigation';

const MyComponent = () => {
  const { handleEnterAndSpace } = useKeyboardNavigation();

  return (
    <div>
      {/* 使用无障碍交互组件 */}
      <FocusableItem
        onClick={() => console.log('clicked')}
        className="bg-blue-500 text-white px-4 py-2 rounded"
      >
        无障碍按钮
      </FocusableItem>

      {/* 手动实现键盘支持 */}
      <div
        role="button"
        tabIndex={0}
        onClick={() => console.log('custom clicked')}
        onKeyDown={handleEnterAndSpace(() => console.log('custom clicked'))}
        className="focus:ring-2 focus:ring-blue-500"
      >
        自定义可访问元素
      </div>
    </div>
  );
};
```

## 检查清单使用指南

1. **新组件开发**：开发前浏览本清单，确保考虑所有无障碍要求
2. **组件修改**：针对修改内容，检查相关无障碍项是否仍然满足
3. **代码审查**：使用本清单作为代码审查的标准之一
4. **递交前检查**：提交PR前，完成最后的无障碍验证

记住，良好的无障碍设计不仅帮助有特殊需求的用户，也提升了所有用户的体验。
