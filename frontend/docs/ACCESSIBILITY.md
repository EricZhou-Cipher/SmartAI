# 前端无障碍测试指南

本文档提供了前端项目无障碍(a11y)测试的相关指南，工具和最佳实践，帮助开发者确保应用程序符合WCAG 2.1 AA标准，并对所有用户友好。

## 目录

- [自动化测试工具](#自动化测试工具)
- [运行无障碍检查](#运行无障碍检查)
- [解读检查报告](#解读检查报告)
- [常见无障碍问题和修复方法](#常见无障碍问题和修复方法)
- [开发过程中的无障碍注意事项](#开发过程中的无障碍注意事项)
- [无障碍检查清单](#无障碍检查清单)

## 自动化测试工具

我们开发了一套全面的无障碍测试工具，能够自动检测前端代码中的常见无障碍问题：

1. **颜色对比度检查** - 检查文本与背景颜色之间的对比度是否符合WCAG标准
2. **键盘焦点和导航检查** - 确保所有交互元素都可通过键盘访问
3. **标题结构检查** - 验证页面标题的层次结构是否合理
4. **ARIA属性检查** - 检测ARIA属性的使用是否正确
5. **图片alt文本检查** - 确保所有图片都有适当的替代文本
6. **表单标签关联检查** - 验证表单元素是否都有关联的标签

所有这些工具都集成在一个主要的审计脚本中，可生成详细的HTML报告。

## 运行无障碍检查

### 完整审计

运行完整的无障碍审计并生成报告：

```bash
yarn a11y:check
```

此命令会运行所有无障碍检查，并在`a11y-reports`目录中生成HTML和JSON报告文件。

### 单独运行特定检查

如果你想只运行特定的检查，可以使用以下命令：

```bash
# 检查颜色对比度问题
yarn a11y:color

# 检查键盘焦点和导航问题
yarn a11y:keyboard

# 检查标题结构问题
yarn a11y:heading
```

### 集成到开发流程

建议将无障碍检查集成到你的常规开发流程中：

1. **本地开发时**：定期运行检查，尤其是在修改UI组件后
2. **提交前**：在提交前运行检查，确保没有引入新的无障碍问题
3. **CI/CD流程**：将检查集成到持续集成流程中，在每次PR时自动运行

## 解读检查报告

无障碍检查报告以HTML格式生成，分为三个严重级别：

- **严重问题**：这些问题严重影响残障用户的使用体验，必须修复
- **主要问题**：这些问题对部分用户造成障碍，应当尽快修复
- **次要问题**：这些问题可能影响用户体验，但不会完全阻止使用，建议修复

报告提供了问题的详细信息，包括：

- 问题类型
- 问题位置（文件和行号）
- 问题详情
- 代码示例
- 修复建议

## 常见无障碍问题和修复方法

### 1. 颜色对比度不足

**问题**：文本与背景的对比度低于4.5:1（普通文本）或3:1（大文本）。

**修复**：

- 使用更深色的文本或更浅色的背景
- 增加文本大小或粗细
- 使用对比度检查工具验证更改

### 2. 缺少键盘导航支持

**问题**：交互元素无法通过键盘访问或缺少焦点样式。

**修复**：

- 为自定义交互元素添加`tabIndex={0}`
- 添加键盘事件处理（例如`onKeyDown`）
- 添加清晰的焦点样式（`:focus`和`:focus-visible`）
- 使用适当的语义化HTML元素（如`<button>`代替可点击的`<div>`）

### 3. 标题层次结构不合理

**问题**：页面标题跳级或页面缺少主标题。

**修复**：

- 确保每个页面有一个`<h1>`主标题
- 标题层次应从h1开始依次使用h2、h3等，不跳级
- 使用语义化标题元素，而不是样式化的普通文本

### 4. ARIA属性使用不当

**问题**：ARIA属性使用错误或与元素不兼容。

**修复**：

- 确保ARIA属性名称正确（参考WAI-ARIA规范）
- 不要在可聚焦元素上使用`aria-hidden="true"`
- 确保`role`值与元素的行为一致

### 5. 图片缺少替代文本

**问题**：图片没有alt属性或交互图片使用空alt。

**修复**：

- 为所有非装饰性图片添加描述性alt文本
- 对于装饰性图片，使用`alt=""`
- 确保交互性图片有描述性alt文本

### 6. 表单元素缺少标签

**问题**：输入元素没有关联的标签。

**修复**：

- 使用`<label htmlFor="elementId">`关联表单元素
- 确保每个输入元素有唯一ID
- 如果不能使用label元素，则使用`aria-label`或`aria-labelledby`

## 开发过程中的无障碍注意事项

1. **从设计阶段考虑无障碍性**：在设计UI时考虑颜色对比度、键盘导航和屏幕阅读器支持
2. **使用语义化HTML**：优先使用适当的HTML元素，而不是自定义样式的通用元素
3. **进行手动测试**：使用键盘导航测试应用程序，使用屏幕阅读器验证体验
4. **遵循无障碍模式**：使用已建立的组件模式，如模态、下拉菜单等的无障碍实现
5. **考虑不同的使用场景**：考虑各种残障用户如何使用你的应用程序

## 无障碍检查清单

在开发新功能或修改现有功能时，请确保：

- [ ] 所有颜色对比度符合WCAG AA标准（4.5:1或3:1）
- [ ] 所有交互元素可通过键盘访问
- [ ] 所有可聚焦元素有明显的焦点样式
- [ ] 页面结构使用合理的标题层次（h1-h6）
- [ ] 所有图片有适当的替代文本
- [ ] 所有表单控件有关联的标签
- [ ] 交互元素使用适当的ARIA角色和属性
- [ ] 动态内容变化通知屏幕阅读器（如使用aria-live）
- [ ] 复杂组件（如模态、下拉菜单）遵循WAI-ARIA实践
- [ ] 在不同屏幕尺寸上测试无障碍性

---

通过定期运行我们的自动化无障碍检测工具，并遵循上述指南，我们可以确保我们的前端应用对所有用户都具有良好的可访问性。
