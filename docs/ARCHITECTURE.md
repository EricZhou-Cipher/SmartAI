# SmartAI 系统架构设计

本文档详细描述 SmartAI 区块链智能分析平台的系统架构，包括各个组件的功能和交互方式。

## 系统架构概览

SmartAI 采用现代化微服务架构，主要分为以下几个核心部分：

```
                          ┌─────────────────┐
                          │   用户界面层    │
                          │  (Next.js前端)  │
                          └────────┬────────┘
                                   │
                                   ▼
┌────────────────┐      ┌─────────────────┐      ┌────────────────┐
│                │      │                 │      │                │
│  区块链数据层  │◄────►│   API服务层     │◄────►│  数据存储层    │
│                │      │                 │      │                │
└────────────────┘      └────────┬────────┘      └────────────────┘
                                 │
                                 ▼
                        ┌─────────────────┐
                        │   分析引擎层    │
                        │                 │
                        └─────────────────┘
```

## 1. 用户界面层 (前端)

技术栈：React、Next.js、Chakra UI、D3.js

主要组件：

- **页面组件** (`frontend/pages/`): 路由对应的页面组件
- **UI 组件** (`frontend/components/`): 可重用的界面组件
- **API 客户端** (`frontend/api/`): 与后端 API 交互的客户端
- **上下文提供者** (`frontend/context/`): React 上下文管理器
- **工具函数** (`frontend/utils/`): 公用工具函数和助手

### 数据流向

1. 用户通过浏览器访问前端应用
2. 前端通过 API 客户端向后端发送请求
3. 接收到数据后进行状态更新和渲染
4. 用户交互触发新的数据请求或状态变更

## 2. API 服务层 (后端)

技术栈：Node.js、Express、TypeScript

主要组件：

- **API 路由** (`backend/src/routes/`): 处理 REST API 请求
- **控制器** (`backend/src/controllers/`): 业务逻辑控制器
- **服务** (`backend/src/services/`): 核心业务服务
- **中间件** (`backend/src/middleware/`): 请求处理中间件
- **数据访问** (`backend/src/database/`): 数据库访问层

### 数据流向

1. 接收来自前端的 HTTP 请求
2. 通过中间件进行认证、验证等处理
3. 路由将请求分发到相应的控制器
4. 控制器调用服务层执行业务逻辑
5. 服务层与数据库交互并返回结果

## 3. 区块链数据层

技术栈：Web3.js、Ethers.js

主要组件：

- **区块链连接器** (`backend/src/blockchain/`): 与区块链网络交互
- **数据采集器** (`backend/src/collectors/`): 从区块链获取数据
- **交易分析器** (`backend/src/analyzers/`): 分析交易和智能合约
- **数据规范化器** (`backend/src/normalizers/`): 规范化区块链数据

### 数据流向

1. 通过 RPC 与区块链节点建立连接
2. 采集交易、账户和代币数据
3. 规范化和清洗区块链原始数据
4. 将处理后的数据传递给分析引擎或存储到数据库

## 4. 分析引擎层

技术栈：Node.js、机器学习库

主要组件：

- **聪明钱识别器** (`backend/src/core/SmartMoneyIdentifier.ts`): 识别聪明钱账户
- **投资组合追踪器** (`backend/src/core/PortfolioTracker.ts`): 追踪投资组合变化
- **交易模式分析器** (`backend/src/core/TransactionPatternAnalyzer.ts`): 分析交易模式
- **风险评估器** (`backend/src/core/RiskAssessor.ts`): 评估交易和代币风险

### 数据流向

1. 接收来自区块链数据层的处理后数据
2. 应用各种分析算法和模型
3. 生成分析结果和洞察
4. 将结果存储并提供给 API 服务层

## 5. 数据存储层

技术栈：MongoDB、Redis

主要组件：

- **数据库模型** (`backend/src/database/models/`): 数据库架构定义
- **数据访问对象** (`backend/src/database/dao/`): 数据库操作封装
- **缓存管理** (`backend/src/utils/cache.ts`): 缓存机制

### 数据流向

1. 存储来自区块链和分析引擎的数据
2. 为 API 服务层提供数据访问
3. 缓存频繁访问的数据以提高性能

## 组件交互流程

以"聪明钱分析"功能为例：

1. 用户在前端输入区块链地址
2. 前端发送 API 请求到后端
3. 后端控制器接收请求并委派给服务层
4. 服务层调用区块链数据层获取地址数据
5. 区块链数据层从区块链网络获取原始数据并规范化
6. 分析引擎处理数据并生成分析结果
7. 结果存储在数据库中并返回给前端
8. 前端渲染结果供用户查看

## 数据模型

核心数据模型：

- **SmartMoneyProfile**: 聪明钱投资者资料
- **TransactionPattern**: 交易模式定义
- **Portfolio**: 投资组合数据
- **RiskAssessment**: 风险评估结果
- **Token**: 代币信息

## 扩展性设计

系统采用以下方式保证扩展性：

1. **模块化架构**: 各组件高内聚低耦合
2. **微服务设计**: 核心功能可独立扩展
3. **消息队列**: 异步任务处理
4. **缓存策略**: 提高重复请求响应速度

## 部署架构

生产环境部署架构：

```
                     ┌─────────────┐
                     │   负载均衡  │
                     └──────┬──────┘
                            │
         ┌─────────────────┬┴┬─────────────────┐
         │                 │ │                 │
         ▼                 ▼ │                 ▼
┌─────────────────┐ ┌───────┴─┴───────┐ ┌─────────────────┐
│  前端服务集群   │ │  API服务集群    │ │  分析服务集群   │
└─────────────────┘ └─────────────────┘ └─────────────────┘
         │                 │                     │
         └─────────────────┼─────────────────────┘
                           │
                   ┌───────┴────────┐
                   │                │
                   │  数据库集群    │
                   │                │
                   └────────────────┘
```

## 安全设计

- **HTTPS**: 所有 API 通信加密
- **API 鉴权**: 基于 JWT 的认证机制
- **输入验证**: 所有用户输入严格验证
- **数据加密**: 敏感数据加密存储
- **访问控制**: 基于角色的权限控制

## 性能优化

- **缓存策略**: 使用 Redis 缓存频繁访问数据
- **数据库索引**: 优化查询性能
- **异步处理**: 长时间任务异步执行
- **前端性能**: 组件懒加载和代码分割

## 未来架构演进计划

1. **分布式追踪**: 引入分布式追踪系统监控服务调用
2. **服务网格**: 引入服务网格管理微服务通信
3. **实时分析**: 增强实时数据分析能力
4. **多链支持**: 扩展支持更多区块链平台
